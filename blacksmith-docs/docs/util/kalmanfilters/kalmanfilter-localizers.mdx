---
sidebar_position: 2
title: Kalman Filter Localizers
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Kalman Filter Localizers

Kalman filters are great tools for the mechanisms on your robot, but they're great on your localizer as well! The standard run-of-the-mill two wheel and three wheel tracking localizer has been extended to by adding Kalman filters on each of the localizer's outputs.
Doing this reduces the drift of the robot and should help make your autonomous more reliable.

## Tuning

Each set of Kalman noise fields per localizer is the same. A rough approximation like the one below (that's what we used) should be fine. Note to pay attention to the range of numbers you're dealing with!
Anywhere from 5-35 for the wheel position and velocity filters is reasonable, and 0.10-0.75 is reasonable for the heading filters. I'd reccomend starting with a low number and gradually increasing until you notice adverse affects, if any.

Edit the following fields in `KalmanTwoWheelLocalizer` or `KalmanThreeWheelLocalizer`:

<Tabs groupId="programming-language">
<TabItem value="kotlin" label="Kotlin">

  ```kotlin
    private val headingFilter = KalmanFilter(0.25, 0.125)
    private val wheelPos1Filter = KalmanFilter(9.0, 11.0)
    private val wheelPos2Filter = KalmanFilter(9.0, 11.0)
    private val headingVelocityFilter = KalmanFilter(0.500, 0.225)
    private val wheelPos1VelocityFilter = KalmanFilter(8.0, 7.0)
    private val wheelPos2VelocityFilter = KalmanFilter(8.0, 7.0)
  ```

</TabItem>

</Tabs>

## Kalman Two Wheel Localization

To use your two wheel Kalman localizer, edit the fields as seen above in `KalmanTwoWheelLocalizer` and simply change the `setLocalizer` line in `SampleMecanumDrive` and `SampleMecanumDriveCancellable` to the following:

:::warning
Make sure to edit BOTH `SampleMecanumDrive` and `SampleMecanumDriveCancellable`, otherwise it may not be put into effect! If you're using some other drive object, change the localizer there.
:::

<Tabs groupId="programming-language">
<TabItem value="kotlin" label="Kotlin">

  ```kotlin
     setLocalizer(new KalmanTwoWheelLocalizer(new TwoWheelTrackingLocalizer(hardwareMap, this)));
  ```
</TabItem>
</Tabs>

## Kalman Three Wheel Localization

:::warning
Make sure to edit BOTH `SampleMecanumDrive` and `SampleMecanumDriveCancellable`, otherwise it may not be put into effect! If you're using some other drive object, change the localizer there.
:::

To use your three wheel Kalman localizer, edit the fields as seen above in `KalmanThreeWheelLocalizer` and change the `setLocalizer` line in `SampleMecanumDrive` and `SampleMecanumDriveCancellable` to the following:
It's pretty much the same thing as for the two wheel localizer but with a few name changes. 

<Tabs groupId="programming-language">
<TabItem value="kotlin" label="Kotlin">

  ```Kotlin
     setLocalizer(new KalmanThreeWheelLocalizer(new StandardTrackingWheelLocalizer(hardwareMap, this)));
  ```
</TabItem>
</Tabs>
